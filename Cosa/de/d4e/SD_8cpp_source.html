<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>COSA: libraries/SD/SD.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">COSA
   </div>
   <div id="projectbrief">An Object-Oriented Platform for Arduino Programming</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('de/d4e/SD_8cpp_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SD.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../de/d4e/SD_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d36/SD_8hh.html">SD.hh</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dfc/RTT_8hh.html">Cosa/RTT.hh</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// Configuration: Allow SPI transfer interleaving, table driven CRC.</span></div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="../../de/d4e/SD_8cpp.html#adefcc85acf9ff291c76d3ad2d8319386">   25</a></span>&#160;<span class="preprocessor">#define USE_SPI_PREFETCH</span></div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="../../de/d4e/SD_8cpp.html#ae0cb8b1f2e4961a2d6169132c371a7d5">   26</a></span>&#160;<span class="preprocessor">#define USE_CRCTAB</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> uint8_t <a class="code" href="../../de/d4e/SD_8cpp.html#ab11eb18fbe360744445cab27ffeb48de">crc7</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>* buf, <span class="keywordtype">size_t</span> size)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  __attribute__((always_inline));</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> uint8_t</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="../../de/d4e/SD_8cpp.html#ab11eb18fbe360744445cab27ffeb48de">   32</a></span>&#160;<a class="code" href="../../de/d4e/SD_8cpp.html#ab11eb18fbe360744445cab27ffeb48de">crc7</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>* buf, <span class="keywordtype">size_t</span> size)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  uint8_t* bp = (uint8_t*) buf;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  uint8_t crc = 0;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">while</span> (size--) {</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    uint8_t data = *bp++;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    data ^= crc &lt;&lt; 1;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">if</span> (data &amp; 0x80) data ^= 9;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    crc = data ^ (crc &amp; 0x78) ^ (crc &lt;&lt; 4) ^ ((crc &gt;&gt; 3) &amp; 0x0f);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  }</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  crc = (crc &lt;&lt; 1) ^ (crc &lt;&lt; 4) ^ (crc &amp; 0x70) ^ ((crc &gt;&gt; 3) &amp; 0x0f);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">return</span> (crc | 1);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#if defined(USE_CRCTAB)</span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="../../de/d4e/SD_8cpp.html#a5aa1f25b671940564734e68a00c2b4b6">   47</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint16_t crctab[] <a class="code" href="../../de/d4e/SD_8cpp.html#a5aa1f25b671940564734e68a00c2b4b6">__PROGMEM</a> = {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  0x0000, 0x1021, 0x2042, 0x3063, 0x4084, 0x50a5, 0x60c6, 0x70e7,</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  0x8108, 0x9129, 0xa14a, 0xb16b, 0xc18c, 0xd1ad, 0xe1ce, 0xf1ef,</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  0x1231, 0x0210, 0x3273, 0x2252, 0x52b5, 0x4294, 0x72f7, 0x62d6,</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  0x9339, 0x8318, 0xb37b, 0xa35a, 0xd3bd, 0xc39c, 0xf3ff, 0xe3de,</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  0x2462, 0x3443, 0x0420, 0x1401, 0x64e6, 0x74c7, 0x44a4, 0x5485,</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  0xa56a, 0xb54b, 0x8528, 0x9509, 0xe5ee, 0xf5cf, 0xc5ac, 0xd58d,</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  0x3653, 0x2672, 0x1611, 0x0630, 0x76d7, 0x66f6, 0x5695, 0x46b4,</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  0xb75b, 0xa77a, 0x9719, 0x8738, 0xf7df, 0xe7fe, 0xd79d, 0xc7bc,</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  0x48c4, 0x58e5, 0x6886, 0x78a7, 0x0840, 0x1861, 0x2802, 0x3823,</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  0xc9cc, 0xd9ed, 0xe98e, 0xf9af, 0x8948, 0x9969, 0xa90a, 0xb92b,</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  0x5af5, 0x4ad4, 0x7ab7, 0x6a96, 0x1a71, 0x0a50, 0x3a33, 0x2a12,</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  0xdbfd, 0xcbdc, 0xfbbf, 0xeb9e, 0x9b79, 0x8b58, 0xbb3b, 0xab1a,</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  0x6ca6, 0x7c87, 0x4ce4, 0x5cc5, 0x2c22, 0x3c03, 0x0c60, 0x1c41,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  0xedae, 0xfd8f, 0xcdec, 0xddcd, 0xad2a, 0xbd0b, 0x8d68, 0x9d49,</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  0x7e97, 0x6eb6, 0x5ed5, 0x4ef4, 0x3e13, 0x2e32, 0x1e51, 0x0e70,</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  0xff9f, 0xefbe, 0xdfdd, 0xcffc, 0xbf1b, 0xaf3a, 0x9f59, 0x8f78,</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  0x9188, 0x81a9, 0xb1ca, 0xa1eb, 0xd10c, 0xc12d, 0xf14e, 0xe16f,</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  0x1080, 0x00a1, 0x30c2, 0x20e3, 0x5004, 0x4025, 0x7046, 0x6067,</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  0x83b9, 0x9398, 0xa3fb, 0xb3da, 0xc33d, 0xd31c, 0xe37f, 0xf35e,</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  0x02b1, 0x1290, 0x22f3, 0x32d2, 0x4235, 0x5214, 0x6277, 0x7256,</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  0xb5ea, 0xa5cb, 0x95a8, 0x8589, 0xf56e, 0xe54f, 0xd52c, 0xc50d,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  0x34e2, 0x24c3, 0x14a0, 0x0481, 0x7466, 0x6447, 0x5424, 0x4405,</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  0xa7db, 0xb7fa, 0x8799, 0x97b8, 0xe75f, 0xf77e, 0xc71d, 0xd73c,</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  0x26d3, 0x36f2, 0x0691, 0x16b0, 0x6657, 0x7676, 0x4615, 0x5634,</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  0xd94c, 0xc96d, 0xf90e, 0xe92f, 0x99c8, 0x89e9, 0xb98a, 0xa9ab,</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  0x5844, 0x4865, 0x7806, 0x6827, 0x18c0, 0x08e1, 0x3882, 0x28a3,</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  0xcb7d, 0xdb5c, 0xeb3f, 0xfb1e, 0x8bf9, 0x9bd8, 0xabbb, 0xbb9a,</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  0x4a75, 0x5a54, 0x6a37, 0x7a16, 0x0af1, 0x1ad0, 0x2ab3, 0x3a92,</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  0xfd2e, 0xed0f, 0xdd6c, 0xcd4d, 0xbdaa, 0xad8b, 0x9de8, 0x8dc9,</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  0x7c26, 0x6c07, 0x5c64, 0x4c45, 0x3ca2, 0x2c83, 0x1ce0, 0x0cc1,</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  0xef1f, 0xff3e, 0xcf5d, 0xdf7c, 0xaf9b, 0xbfba, 0x8fd9, 0x9ff8,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  0x6e17, 0x7e36, 0x4e55, 0x5e74, 0x2e93, 0x3eb2, 0x0ed1, 0x1ef0</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;};</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> uint16_t <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(uint16_t crc, uint8_t data)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  __attribute__((always_inline));</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> uint16_t</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">   86</a></span>&#160;<a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(uint16_t crc, uint8_t data)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">return</span> (pgm_read_word(&amp;crctab[((crc &gt;&gt; 8) ^ data) &amp; 0Xff]) ^ (crc &lt;&lt; 8));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &lt;util/crc16.h&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;uint8_t</div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">   96</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">SD::send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499">CMD</a> command, uint32_t arg)</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// Build request with command, argument and add check-sum (CRC7)</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="../../d8/d35/structSD_1_1request__t.html">request_t</a> request;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  request.<a class="code" href="../../d8/d35/structSD_1_1request__t.html#a40947492835335007148a050a76cb582">command</a> = (0x40 | command);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  request.<a class="code" href="../../d8/d35/structSD_1_1request__t.html#ac440d8a94c1b9ea75d0c81f00eabd66d">arg</a> = <a class="code" href="../../dc/d2f/Canvas_8cpp.html#a3ca5ecd34b04d6a243c054ac3a57f68d">swap</a>(arg);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  request.<a class="code" href="../../d8/d35/structSD_1_1request__t.html#a750c90addd95b59c4c7e74c2bc1ccb69">crc</a> = <a class="code" href="../../de/d4e/SD_8cpp.html#ab11eb18fbe360744445cab27ffeb48de">crc7</a>(&amp;request, <span class="keyword">sizeof</span>(request) - 1);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// Issue the command; wait while busy</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff) != 0xff)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    ;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(&amp;request, <span class="keyword">sizeof</span>(request));</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">if</span> (command == <a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a143c26dccb203c26fec85fdd5fb02d4c">STOP_TRANSMISSION</a>) <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">// Wait for the response</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  uint8_t response;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="../../d7/da3/classSD.html#a2ce8db87ba97eedae513a7b1cdc3a50a">RESPONSE_RETRY</a>; i++) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    response = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">if</span> ((response &amp; 0x80) == 0) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="../../d7/da3/classSD.html#a84e385cb335f30e39811b82368807fe0">m_response</a> = response);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a4c4fe727d97a0b257071490ca4a10fdb">  120</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">SD::send</a>(uint16_t ms, <a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499">CMD</a> command, uint32_t arg)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;{</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  uint16_t start = <a class="code" href="../../df/dc8/classRTT.html#a2f7169ff053b0455d12bdbc67e4bce82">RTT::millis</a>();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    uint8_t state = <a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(command, arg);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">if</span> (state &lt; <a class="code" href="../../d7/da3/classSD.html#a2a62247e9b0d53e19a6cadc82f5dc138a4f9a3544da5f71e4cf0a273ca308b4b9">IDENT_STATE</a>) <span class="keywordflow">return</span> (<span class="keyword">true</span>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  } <span class="keywordflow">while</span> (((uint16_t) <a class="code" href="../../df/dc8/classRTT.html#a2f7169ff053b0455d12bdbc67e4bce82">RTT::millis</a>()) - start &lt; ms);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;uint8_t</div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a67ebc17ca23fb01c96bc1ff52214c0a8">  131</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">SD::send</a>(<a class="code" href="../../d7/da3/classSD.html#a9f993839f8fc48e384cc92da109d8e7e">ACMD</a> command, uint32_t arg)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499aa15243fc10c8168f13ac2828be118023">APP_CMD</a>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>((<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499">CMD</a>) command, arg));</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a0a944df918dadb416b8cf4396d854951">  138</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">SD::send</a>(uint16_t ms, <a class="code" href="../../d7/da3/classSD.html#a9f993839f8fc48e384cc92da109d8e7e">ACMD</a> command, uint32_t arg)</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;{</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  uint16_t start = <a class="code" href="../../df/dc8/classRTT.html#a2f7169ff053b0455d12bdbc67e4bce82">RTT::millis</a>();</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499aa15243fc10c8168f13ac2828be118023">APP_CMD</a>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    uint8_t state = <a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>((<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499">CMD</a>) command, arg);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span> (state &lt; <a class="code" href="../../d7/da3/classSD.html#a2a62247e9b0d53e19a6cadc82f5dc138a4f9a3544da5f71e4cf0a273ca308b4b9">IDENT_STATE</a>) <span class="keywordflow">return</span> (<span class="keyword">true</span>);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  } <span class="keywordflow">while</span> (((uint16_t) <a class="code" href="../../df/dc8/classRTT.html#a2f7169ff053b0455d12bdbc67e4bce82">RTT::millis</a>()) - start &lt; ms);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a481a3ce965876de61da4d2a1d274fd8a">  150</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a481a3ce965876de61da4d2a1d274fd8a">SD::await</a>(uint16_t ms, uint8_t token)</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;{</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  uint16_t start = <a class="code" href="../../df/dc8/classRTT.html#a2f7169ff053b0455d12bdbc67e4bce82">RTT::millis</a>();</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    uint8_t response = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (response != 0xff) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <a class="code" href="../../d7/da3/classSD.html#a84e385cb335f30e39811b82368807fe0">m_response</a> = response;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="keywordflow">return</span> (token != 0 ? response == token : <span class="keyword">true</span>);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  } <span class="keywordflow">while</span> ((ms == 0) || (((uint16_t) <a class="code" href="../../df/dc8/classRTT.html#a2f7169ff053b0455d12bdbc67e4bce82">RTT::millis</a>()) - start &lt; ms));</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;uint32_t</div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a84241bbe485672c35b78e1a5a17ccf55">  164</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a84241bbe485672c35b78e1a5a17ccf55">SD::receive</a>()</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;{</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <a class="code" href="../../d8/d84/unionuniv32__t.html">univ32_t</a> res;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="preprocessor">#if defined(USE_SPI_PREFETCH)</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ab0873ff9ab5084a6a0f679699613b39d">transfer_start</a>(0xff);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  res.<a class="code" href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">as_uint8</a>[3] = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ab0adf60a4f02c488434ab6fd1c2e891d">transfer_next</a>(0xff);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  res.<a class="code" href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">as_uint8</a>[2] = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ab0adf60a4f02c488434ab6fd1c2e891d">transfer_next</a>(0xff);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  res.<a class="code" href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">as_uint8</a>[1] = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ab0adf60a4f02c488434ab6fd1c2e891d">transfer_next</a>(0xff);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  res.<a class="code" href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">as_uint8</a>[0] = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a1071639880475d6ae4d3cc9519489c13">transfer_await</a>();</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  res.<a class="code" href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">as_uint8</a>[3] = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  res.<a class="code" href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">as_uint8</a>[2] = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  res.<a class="code" href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">as_uint8</a>[1] = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  res.<a class="code" href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">as_uint8</a>[0] = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordflow">return</span> (res.<a class="code" href="../../d8/d84/unionuniv32__t.html#afe83a8bf2f2b43f005fa3a8883b9b9df">as_uint32</a>);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#ac3e0341f5a5ebb7dc1eb6f75cea5497a">  183</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#ac3e0341f5a5ebb7dc1eb6f75cea5497a">SD::read</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499">CMD</a> command, uint32_t arg, <span class="keywordtype">void</span>* buf, <span class="keywordtype">size_t</span> count)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  uint8_t* dst = (uint8_t*) buf;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  uint16_t crc = 0;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordtype">bool</span> res = <span class="keyword">false</span>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  uint8_t data;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// Issue read command and receive data into buffer</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a83e6f51c6e4527849cc892470ae4669a">acquire</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a110559d298e75303eb8953e0d2dbbe9e">begin</a>();</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(command, arg)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d7/da3/classSD.html#a481a3ce965876de61da4d2a1d274fd8a">await</a>(<a class="code" href="../../d7/da3/classSD.html#ade7757d83420a87d23f3a16deccf1633">READ_TIMEOUT</a>, <a class="code" href="../../d7/da3/classSD.html#a16eff982e611224ee97b6ad03a7c0a20a346854172cd4119c06e1014233c1a28c">DATA_START_BLOCK</a>)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor">#if defined(USE_SPI_PREFETCH)</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ab0873ff9ab5084a6a0f679699613b39d">transfer_start</a>(0xff);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordflow">while</span> (--count) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        data = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ab0adf60a4f02c488434ab6fd1c2e891d">transfer_next</a>(0xff);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        *dst++ = data;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        crc = <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(crc, data);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      data = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a1071639880475d6ae4d3cc9519489c13">transfer_await</a>();</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      *dst = data;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      crc = <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(crc, data);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        uint8_t data = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        *dst++ = data;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        crc = <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(crc, data);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      } <span class="keywordflow">while</span> (--count);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="comment">// Receive the check sum and check</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      crc = <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(crc, <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff));</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      crc = <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(crc, <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff));</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      res = (crc == 0);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; error:</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#af5e85fda4c7815cdeece541fcc34a752">end</a>();</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ae3c7a86fc8be073bc6040e7636f2cf26">release</a>();</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">return</span> (res);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a900e57070ece1f6ebce92869b815b388">  226</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a900e57070ece1f6ebce92869b815b388">SD::begin</a>(<a class="code" href="../../da/d8d/classSPI.html#a2e7312dac82d834b4cbbfcba4e737643">SPI::Clock</a> rate)</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;{</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">bool</span> res = <span class="keyword">false</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  uint32_t arg;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <a class="code" href="../../de/d14/unionSD_1_1R1.html">R1</a> status;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">// Start with unknown card type</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <a class="code" href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">m_type</a> = <a class="code" href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883ab124b76d74fb0e4036b92eea214788df">TYPE_UNKNOWN</a>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a83e6f51c6e4527849cc892470ae4669a">acquire</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a110559d298e75303eb8953e0d2dbbe9e">begin</a>();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// Card needs 74 cycles minimum to start up</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="../../d7/da3/classSD.html#a0ac75be183110ebf98e3c57f3cac3cf0">INIT_PULSES</a>; i++) <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="comment">// Reset card</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#af794715501c5be3cd8a0b1d4a7d2b772">INIT_TIMEOUT</a>, <a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a18ebc3b9a866ed411f97b71c630f73a3">GO_IDLE_STATE</a>)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="comment">// Enable CRC</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      status = <a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499acb68f8ff6d5b4da6c25d7000d7a73096">CRC_ON_OFF</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">if</span> (status.<a class="code" href="../../de/d14/unionSD_1_1R1.html#ad22d3c33ce7422e5d128a4a6dbc001b9">is_error</a>()) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="comment">// Check for version of SD card specification; 2.7-3.6V and check pattern</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <a class="code" href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">m_type</a> = <a class="code" href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883a2e0601e809ff9703b1fcd5927955f95c">TYPE_SD1</a>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      arg = (0x100 | <a class="code" href="../../d7/da3/classSD.html#a49fd6079ad6916aac7fb7bc3e147a00b">CHECK_PATTERN</a>);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      status = <a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a8b06b2a9dc02218ee9ab4c19dc8060b6">SEND_IF_COND</a>, arg);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">if</span> (status.<a class="code" href="../../de/d14/unionSD_1_1R1.html#a3345ac0f41e6bc0cce7125e7d2fc27e7">in_idle_state</a>) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <a class="code" href="../../d4/d2b/unionSD_1_1R7.html">R7</a> r7 = <a class="code" href="../../d7/da3/classSD.html#a84241bbe485672c35b78e1a5a17ccf55">receive</a>();</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> (r7.<a class="code" href="../../d4/d2b/unionSD_1_1R7.html#a8d31f882c20a4ffdd14b5c64b5b99731">check_pattern</a> != <a class="code" href="../../d7/da3/classSD.html#a49fd6079ad6916aac7fb7bc3e147a00b">CHECK_PATTERN</a>) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <a class="code" href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">m_type</a> = <a class="code" href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883a8d806ccaf3184b1efd1d54cbc77ec4de">TYPE_SD2</a>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="comment">// Tell the device that the host supports SDHC</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      arg = (<a class="code" href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">m_type</a> == <a class="code" href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883a2e0601e809ff9703b1fcd5927955f95c">TYPE_SD1</a>) ? 0L : 0X40000000L;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="../../d7/da3/classSD.html#a33e92bf79a405e1cac2a1646d4f3ed95">INIT_RETRY</a>; i++) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#af794715501c5be3cd8a0b1d4a7d2b772">INIT_TIMEOUT</a>, <a class="code" href="../../d7/da3/classSD.html#a9f993839f8fc48e384cc92da109d8e7ea0438fc0b8ef1003899400c2ee6bc3373">SD_SEND_OP_COND</a>, arg)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#a84e385cb335f30e39811b82368807fe0">m_response</a> == 0) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="comment">// Read OCR register and check type</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">m_type</a> == <a class="code" href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883a8d806ccaf3184b1efd1d54cbc77ec4de">TYPE_SD2</a>) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        status = <a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a6792a6a3db648c41db8818a61f33ab48">READ_OCR</a>);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">if</span> (status.<a class="code" href="../../de/d14/unionSD_1_1R1.html#ad22d3c33ce7422e5d128a4a6dbc001b9">is_error</a>()) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        uint32_t ocr = <a class="code" href="../../d7/da3/classSD.html#a84241bbe485672c35b78e1a5a17ccf55">receive</a>();</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">if</span> ((ocr &amp; 0xC0000000L) == 0xC0000000L) <a class="code" href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">m_type</a> = <a class="code" href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883aeb42ae78263d662bcb72c521195132d8">TYPE_SDHC</a>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="comment">// Set the request clock rate</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <a class="code" href="../../dc/dd2/classSPI_1_1Driver.html#a368106f55f7de40a15ae6db283aa30ae">set_clock</a>(rate);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      res = <span class="keyword">true</span>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; error:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#af5e85fda4c7815cdeece541fcc34a752">end</a>();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ae3c7a86fc8be073bc6040e7636f2cf26">release</a>();</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">return</span> (res);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a408ab2b7954ecc4db98cbc3cd20f8026">  283</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a408ab2b7954ecc4db98cbc3cd20f8026">SD::end</a>()</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;{</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">return</span> (<span class="keyword">true</span>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#a35f383515aadafb7ca1049e5a7bef9be">  289</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#a35f383515aadafb7ca1049e5a7bef9be">SD::erase</a>(uint32_t start, uint32_t <a class="code" href="../../d7/da3/classSD.html#a408ab2b7954ecc4db98cbc3cd20f8026">end</a>)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;{</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordtype">bool</span> res = <span class="keyword">false</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// Check if block address should be mapped to byte address</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">m_type</a> != <a class="code" href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883aeb42ae78263d662bcb72c521195132d8">TYPE_SDHC</a>) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    start &lt;&lt;= 9;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    end &lt;&lt;= 9;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="comment">// Send commands for block erase</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a83e6f51c6e4527849cc892470ae4669a">acquire</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a110559d298e75303eb8953e0d2dbbe9e">begin</a>();</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a06f21c9c3a312124b6c7401f744a8a66">ERASE_WR_BLK_START</a>, start)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a4916e8be79f25d94a60557103ee00cab">ERASE_WR_BLK_END</a>, end)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499abebcb3f7d0615f4ed8b198312b39ec4a">ERASE</a>)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d7/da3/classSD.html#a481a3ce965876de61da4d2a1d274fd8a">await</a>(<a class="code" href="../../d7/da3/classSD.html#afe70f1d65c65900713a2e3e3fe89d7e6">ERASE_TIMEOUT</a>)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      res = <span class="keyword">true</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; error:</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#af5e85fda4c7815cdeece541fcc34a752">end</a>();</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ae3c7a86fc8be073bc6040e7636f2cf26">release</a>();</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordflow">return</span> (res);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="../../d7/da3/classSD.html#ab551d5ea4dd79a4c6ebc514942358c3b">  314</a></span>&#160;<a class="code" href="../../d7/da3/classSD.html#ab551d5ea4dd79a4c6ebc514942358c3b">SD::write</a>(uint32_t block, <span class="keyword">const</span> uint8_t* src)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  uint16_t crc = 0;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  uint16_t count = <a class="code" href="../../d7/da3/classSD.html#a493e73155ce3a45619248f47ee206d71">BLOCK_MAX</a>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  uint8_t status;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  uint8_t data;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordtype">bool</span> res = <span class="keyword">false</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">// Check for byte address adjustment</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">m_type</a> != <a class="code" href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883aeb42ae78263d662bcb72c521195132d8">TYPE_SDHC</a>) block &lt;&lt;= 9;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">// Issue write block command, transfer block, calculate check sum</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a83e6f51c6e4527849cc892470ae4669a">acquire</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a110559d298e75303eb8953e0d2dbbe9e">begin</a>();</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499af6957b68a685366af804d6cb1e0666ab">WRITE_BLOCK</a>, block)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(<a class="code" href="../../d7/da3/classSD.html#a16eff982e611224ee97b6ad03a7c0a20a346854172cd4119c06e1014233c1a28c">DATA_START_BLOCK</a>);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">#if defined(USE_SPI_PREFETCH)</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      data = *src++;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ab0873ff9ab5084a6a0f679699613b39d">transfer_start</a>(data);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">while</span> (--count) {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        crc = <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(crc, data);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        data = *src++;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a1071639880475d6ae4d3cc9519489c13">transfer_await</a>();</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ab0873ff9ab5084a6a0f679699613b39d">transfer_start</a>(data);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      crc = <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(crc, data);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a1071639880475d6ae4d3cc9519489c13">transfer_await</a>();</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        data = *src++;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(data);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        crc = <a class="code" href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a>(crc, data);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      } <span class="keywordflow">while</span> (--count);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="comment">// Transfer the check sum and receive data response token and check status</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(crc &gt;&gt; 8);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(crc);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      status = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordflow">if</span> ((status &amp; <a class="code" href="../../d7/da3/classSD.html#a16eff982e611224ee97b6ad03a7c0a20aea46bbbb5bf9e387f420ad71f29dae1d">DATA_RES_MASK</a>) != <a class="code" href="../../d7/da3/classSD.html#a16eff982e611224ee97b6ad03a7c0a20a4432697d607e92cec29650712cc58fed">DATA_RES_ACCEPTED</a>) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="comment">// Wait for the write operation to complete and check status</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d7/da3/classSD.html#a481a3ce965876de61da4d2a1d274fd8a">await</a>(<a class="code" href="../../d7/da3/classSD.html#a8d1b86564a7188adb2ba169bc3bf3280">WRITE_TIMEOUT</a>)) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      status = <a class="code" href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">send</a>(<a class="code" href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499aeacc4cf64082a3ff4cc1b37fd1125f8c">SEND_STATUS</a>);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">if</span> (status != 0) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      status = <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">transfer</a>(0xff);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      res = (status == 0);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; error:</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#af5e85fda4c7815cdeece541fcc34a752">end</a>();</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <a class="code" href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">spi</a>.<a class="code" href="../../d5/d41/classSoft_1_1SPI.html#ae3c7a86fc8be073bc6040e7636f2cf26">release</a>();</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">return</span> (res);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="ttc" id="unionuniv32__t_html_af94de96c6e609461e19e2212d292f419"><div class="ttname"><a href="../../d8/d84/unionuniv32__t.html#af94de96c6e609461e19e2212d292f419">univ32_t::as_uint8</a></div><div class="ttdeci">uint8_t as_uint8[4]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df8/Types_8h_source.html#l00136">Types.h:136</a></div></div>
<div class="ttc" id="SD_8cpp_html_a1d8da3f6d038a417dadd4cec8154693c"><div class="ttname"><a href="../../de/d4e/SD_8cpp.html#a1d8da3f6d038a417dadd4cec8154693c">_crc_xmodem_update</a></div><div class="ttdeci">static uint16_t _crc_xmodem_update(uint16_t crc, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00086">SD.cpp:86</a></div></div>
<div class="ttc" id="classSoft_1_1SPI_html_a0dd51237a0b5544ffb240cf00342f3aa"><div class="ttname"><a href="../../d5/d41/classSoft_1_1SPI.html#a0dd51237a0b5544ffb240cf00342f3aa">Soft::SPI::transfer</a></div><div class="ttdeci">uint8_t transfer(uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d70/SOFT__SPI_8cpp_source.html#l00087">SOFT_SPI.cpp:87</a></div></div>
<div class="ttc" id="structSD_1_1request__t_html_a750c90addd95b59c4c7e74c2bc1ccb69"><div class="ttname"><a href="../../d8/d35/structSD_1_1request__t.html#a750c90addd95b59c4c7e74c2bc1ccb69">SD::request_t::crc</a></div><div class="ttdeci">uint8_t crc</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00294">SD.hh:294</a></div></div>
<div class="ttc" id="classSPI_html_a2e7312dac82d834b4cbbfcba4e737643"><div class="ttname"><a href="../../da/d8d/classSPI.html#a2e7312dac82d834b4cbbfcba4e737643">SPI::Clock</a></div><div class="ttdeci">Clock</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d43/SPI_8hh_source.html#l00060">SPI.hh:60</a></div></div>
<div class="ttc" id="unionSD_1_1R1_html_ad22d3c33ce7422e5d128a4a6dbc001b9"><div class="ttname"><a href="../../de/d14/unionSD_1_1R1.html#ad22d3c33ce7422e5d128a4a6dbc001b9">SD::R1::is_error</a></div><div class="ttdeci">bool is_error() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00225">SD.hh:225</a></div></div>
<div class="ttc" id="classSD_html_a35f383515aadafb7ca1049e5a7bef9be"><div class="ttname"><a href="../../d7/da3/classSD.html#a35f383515aadafb7ca1049e5a7bef9be">SD::erase</a></div><div class="ttdeci">bool erase(uint32_t start, uint32_t end)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00289">SD.cpp:289</a></div></div>
<div class="ttc" id="SD_8cpp_html_ab11eb18fbe360744445cab27ffeb48de"><div class="ttname"><a href="../../de/d4e/SD_8cpp.html#ab11eb18fbe360744445cab27ffeb48de">crc7</a></div><div class="ttdeci">static uint8_t crc7(const void *buf, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00032">SD.cpp:32</a></div></div>
<div class="ttc" id="classSD_html_afe70f1d65c65900713a2e3e3fe89d7e6"><div class="ttname"><a href="../../d7/da3/classSD.html#afe70f1d65c65900713a2e3e3fe89d7e6">SD::ERASE_TIMEOUT</a></div><div class="ttdeci">static const uint16_t ERASE_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00299">SD.hh:299</a></div></div>
<div class="ttc" id="classSD_html_a8d1b86564a7188adb2ba169bc3bf3280"><div class="ttname"><a href="../../d7/da3/classSD.html#a8d1b86564a7188adb2ba169bc3bf3280">SD::WRITE_TIMEOUT</a></div><div class="ttdeci">static const uint16_t WRITE_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00301">SD.hh:301</a></div></div>
<div class="ttc" id="SD_8hh_html"><div class="ttname"><a href="../../d6/d36/SD_8hh.html">SD.hh</a></div></div>
<div class="ttc" id="unionSD_1_1R7_html"><div class="ttname"><a href="../../d4/d2b/unionSD_1_1R7.html">SD::R7</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00266">SD.hh:266</a></div></div>
<div class="ttc" id="classSD_html_a493e73155ce3a45619248f47ee206d71"><div class="ttname"><a href="../../d7/da3/classSD.html#a493e73155ce3a45619248f47ee206d71">SD::BLOCK_MAX</a></div><div class="ttdeci">static const size_t BLOCK_MAX</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00038">SD.hh:38</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499acb68f8ff6d5b4da6c25d7000d7a73096"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499acb68f8ff6d5b4da6c25d7000d7a73096">SD::CRC_ON_OFF</a></div><div class="ttdoc">Turns the CRC on/off. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00184">SD.hh:184</a></div></div>
<div class="ttc" id="unionSD_1_1R1_html_a3345ac0f41e6bc0cce7125e7d2fc27e7"><div class="ttname"><a href="../../de/d14/unionSD_1_1R1.html#a3345ac0f41e6bc0cce7125e7d2fc27e7">SD::R1::in_idle_state</a></div><div class="ttdeci">uint8_t in_idle_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00215">SD.hh:215</a></div></div>
<div class="ttc" id="classSD_html_a33e92bf79a405e1cac2a1646d4f3ed95"><div class="ttname"><a href="../../d7/da3/classSD.html#a33e92bf79a405e1cac2a1646d4f3ed95">SD::INIT_RETRY</a></div><div class="ttdeci">static const uint8_t INIT_RETRY</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00307">SD.hh:307</a></div></div>
<div class="ttc" id="classSD_html_ac7f82a865ffcc6ee3f946a213a62a77b"><div class="ttname"><a href="../../d7/da3/classSD.html#ac7f82a865ffcc6ee3f946a213a62a77b">SD::m_type</a></div><div class="ttdeci">CARD m_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00314">SD.hh:314</a></div></div>
<div class="ttc" id="classSoft_1_1SPI_html_a83e6f51c6e4527849cc892470ae4669a"><div class="ttname"><a href="../../d5/d41/classSoft_1_1SPI.html#a83e6f51c6e4527849cc892470ae4669a">Soft::SPI::acquire</a></div><div class="ttdeci">void acquire(Driver *dev)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d70/SOFT__SPI_8cpp_source.html#l00043">SOFT_SPI.cpp:43</a></div></div>
<div class="ttc" id="classSPI_1_1Driver_html_a368106f55f7de40a15ae6db283aa30ae"><div class="ttname"><a href="../../dc/dd2/classSPI_1_1Driver.html#a368106f55f7de40a15ae6db283aa30ae">SPI::Driver::set_clock</a></div><div class="ttdeci">void set_clock(Clock rate)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d38/SPI_8cpp_source.html#l00297">SPI.cpp:297</a></div></div>
<div class="ttc" id="classSD_html_a0ac75be183110ebf98e3c57f3cac3cf0"><div class="ttname"><a href="../../d7/da3/classSD.html#a0ac75be183110ebf98e3c57f3cac3cf0">SD::INIT_PULSES</a></div><div class="ttdeci">static const uint8_t INIT_PULSES</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00304">SD.hh:304</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499af6957b68a685366af804d6cb1e0666ab"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499af6957b68a685366af804d6cb1e0666ab">SD::WRITE_BLOCK</a></div><div class="ttdoc">Write block length bytes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00171">SD.hh:171</a></div></div>
<div class="ttc" id="classSD_html_a74d33d37b8b98d2e1ad9f6af55ca1883aeb42ae78263d662bcb72c521195132d8"><div class="ttname"><a href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883aeb42ae78263d662bcb72c521195132d8">SD::TYPE_SDHC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00045">SD.hh:45</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499aa15243fc10c8168f13ac2828be118023"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499aa15243fc10c8168f13ac2828be118023">SD::APP_CMD</a></div><div class="ttdoc">Next command is application specific command. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00181">SD.hh:181</a></div></div>
<div class="ttc" id="classSD_html_ab551d5ea4dd79a4c6ebc514942358c3b"><div class="ttname"><a href="../../d7/da3/classSD.html#ab551d5ea4dd79a4c6ebc514942358c3b">SD::write</a></div><div class="ttdeci">bool write(uint32_t block, const uint8_t *src)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00314">SD.cpp:314</a></div></div>
<div class="ttc" id="unionSD_1_1R1_html"><div class="ttname"><a href="../../de/d14/unionSD_1_1R1.html">SD::R1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00212">SD.hh:212</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499a18ebc3b9a866ed411f97b71c630f73a3"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a18ebc3b9a866ed411f97b71c630f73a3">SD::GO_IDLE_STATE</a></div><div class="ttdoc">Reset the SD Memory Card. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00152">SD.hh:152</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499a8b06b2a9dc02218ee9ab4c19dc8060b6"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a8b06b2a9dc02218ee9ab4c19dc8060b6">SD::SEND_IF_COND</a></div><div class="ttdoc">Sends SD Memory Card interface condition. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00158">SD.hh:158</a></div></div>
<div class="ttc" id="classSoft_1_1SPI_html_ab0adf60a4f02c488434ab6fd1c2e891d"><div class="ttname"><a href="../../d5/d41/classSoft_1_1SPI.html#ab0adf60a4f02c488434ab6fd1c2e891d">Soft::SPI::transfer_next</a></div><div class="ttdeci">uint8_t transfer_next(uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de6/Soft_2SPI_8hh_source.html#l00261">SPI.hh:261</a></div></div>
<div class="ttc" id="classSD_html_a49fd6079ad6916aac7fb7bc3e147a00b"><div class="ttname"><a href="../../d7/da3/classSD.html#a49fd6079ad6916aac7fb7bc3e147a00b">SD::CHECK_PATTERN</a></div><div class="ttdeci">static const uint8_t CHECK_PATTERN</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00278">SD.hh:278</a></div></div>
<div class="ttc" id="unionuniv32__t_html"><div class="ttname"><a href="../../d8/d84/unionuniv32__t.html">univ32_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df8/Types_8h_source.html#l00129">Types.h:129</a></div></div>
<div class="ttc" id="classSD_html_a74d33d37b8b98d2e1ad9f6af55ca1883ab124b76d74fb0e4036b92eea214788df"><div class="ttname"><a href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883ab124b76d74fb0e4036b92eea214788df">SD::TYPE_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00042">SD.hh:42</a></div></div>
<div class="ttc" id="classSD_html_af794715501c5be3cd8a0b1d4a7d2b772"><div class="ttname"><a href="../../d7/da3/classSD.html#af794715501c5be3cd8a0b1d4a7d2b772">SD::INIT_TIMEOUT</a></div><div class="ttdeci">static const uint16_t INIT_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00298">SD.hh:298</a></div></div>
<div class="ttc" id="structSD_1_1request__t_html_ac440d8a94c1b9ea75d0c81f00eabd66d"><div class="ttname"><a href="../../d8/d35/structSD_1_1request__t.html#ac440d8a94c1b9ea75d0c81f00eabd66d">SD::request_t::arg</a></div><div class="ttdeci">uint32_t arg</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00293">SD.hh:293</a></div></div>
<div class="ttc" id="unionSD_1_1R7_html_a8d31f882c20a4ffdd14b5c64b5b99731"><div class="ttname"><a href="../../d4/d2b/unionSD_1_1R7.html#a8d31f882c20a4ffdd14b5c64b5b99731">SD::R7::check_pattern</a></div><div class="ttdeci">uint8_t check_pattern</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00269">SD.hh:269</a></div></div>
<div class="ttc" id="classSD_html_a74d33d37b8b98d2e1ad9f6af55ca1883a8d806ccaf3184b1efd1d54cbc77ec4de"><div class="ttname"><a href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883a8d806ccaf3184b1efd1d54cbc77ec4de">SD::TYPE_SD2</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00044">SD.hh:44</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499a06f21c9c3a312124b6c7401f744a8a66"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a06f21c9c3a312124b6c7401f744a8a66">SD::ERASE_WR_BLK_START</a></div><div class="ttdoc">Set first write block to be erased. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00177">SD.hh:177</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499aeacc4cf64082a3ff4cc1b37fd1125f8c"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499aeacc4cf64082a3ff4cc1b37fd1125f8c">SD::SEND_STATUS</a></div><div class="ttdoc">Asks the selected card status register. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00163">SD.hh:163</a></div></div>
<div class="ttc" id="classSD_html_a9f993839f8fc48e384cc92da109d8e7e"><div class="ttname"><a href="../../d7/da3/classSD.html#a9f993839f8fc48e384cc92da109d8e7e">SD::ACMD</a></div><div class="ttdeci">ACMD</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00188">SD.hh:188</a></div></div>
<div class="ttc" id="classSD_html_a2a62247e9b0d53e19a6cadc82f5dc138a4f9a3544da5f71e4cf0a273ca308b4b9"><div class="ttname"><a href="../../d7/da3/classSD.html#a2a62247e9b0d53e19a6cadc82f5dc138a4f9a3544da5f71e4cf0a273ca308b4b9">SD::IDENT_STATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00202">SD.hh:202</a></div></div>
<div class="ttc" id="classRTT_html_a2f7169ff053b0455d12bdbc67e4bce82"><div class="ttname"><a href="../../df/dc8/classRTT.html#a2f7169ff053b0455d12bdbc67e4bce82">RTT::millis</a></div><div class="ttdeci">static uint32_t millis()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d5d/RTT_8cpp_source.html#l00121">RTT.cpp:121</a></div></div>
<div class="ttc" id="classSD_html_a16eff982e611224ee97b6ad03a7c0a20a4432697d607e92cec29650712cc58fed"><div class="ttname"><a href="../../d7/da3/classSD.html#a16eff982e611224ee97b6ad03a7c0a20a4432697d607e92cec29650712cc58fed">SD::DATA_RES_ACCEPTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00285">SD.hh:285</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499">SD::CMD</a></div><div class="ttdeci">CMD</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00151">SD.hh:151</a></div></div>
<div class="ttc" id="RTT_8hh_html"><div class="ttname"><a href="../../d3/dfc/RTT_8hh.html">RTT.hh</a></div></div>
<div class="ttc" id="unionuniv32__t_html_afe83a8bf2f2b43f005fa3a8883b9b9df"><div class="ttname"><a href="../../d8/d84/unionuniv32__t.html#afe83a8bf2f2b43f005fa3a8883b9b9df">univ32_t::as_uint32</a></div><div class="ttdeci">uint32_t as_uint32</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df8/Types_8h_source.html#l00131">Types.h:131</a></div></div>
<div class="ttc" id="classSoft_1_1SPI_html_a110559d298e75303eb8953e0d2dbbe9e"><div class="ttname"><a href="../../d5/d41/classSoft_1_1SPI.html#a110559d298e75303eb8953e0d2dbbe9e">Soft::SPI::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de6/Soft_2SPI_8hh_source.html#l00216">SPI.hh:216</a></div></div>
<div class="ttc" id="Canvas_8cpp_html_a3ca5ecd34b04d6a243c054ac3a57f68d"><div class="ttname"><a href="../../dc/d2f/Canvas_8cpp.html#a3ca5ecd34b04d6a243c054ac3a57f68d">swap</a></div><div class="ttdeci">#define swap(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2f/Canvas_8cpp_source.html#l00164">Canvas.cpp:164</a></div></div>
<div class="ttc" id="classSD_html_a481a3ce965876de61da4d2a1d274fd8a"><div class="ttname"><a href="../../d7/da3/classSD.html#a481a3ce965876de61da4d2a1d274fd8a">SD::await</a></div><div class="ttdeci">bool await(uint16_t ms=0, uint8_t token=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00150">SD.cpp:150</a></div></div>
<div class="ttc" id="classSoft_1_1SPI_html_af5e85fda4c7815cdeece541fcc34a752"><div class="ttname"><a href="../../d5/d41/classSoft_1_1SPI.html#af5e85fda4c7815cdeece541fcc34a752">Soft::SPI::end</a></div><div class="ttdeci">void end()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de6/Soft_2SPI_8hh_source.html#l00226">SPI.hh:226</a></div></div>
<div class="ttc" id="classSD_html_a84e385cb335f30e39811b82368807fe0"><div class="ttname"><a href="../../d7/da3/classSD.html#a84e385cb335f30e39811b82368807fe0">SD::m_response</a></div><div class="ttdeci">uint8_t m_response</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00311">SD.hh:311</a></div></div>
<div class="ttc" id="classSD_html_ac3e0341f5a5ebb7dc1eb6f75cea5497a"><div class="ttname"><a href="../../d7/da3/classSD.html#ac3e0341f5a5ebb7dc1eb6f75cea5497a">SD::read</a></div><div class="ttdeci">bool read(CMD command, uint32_t arg, void *buf, size_t count)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00183">SD.cpp:183</a></div></div>
<div class="ttc" id="classSoft_1_1SPI_html_a1071639880475d6ae4d3cc9519489c13"><div class="ttname"><a href="../../d5/d41/classSoft_1_1SPI.html#a1071639880475d6ae4d3cc9519489c13">Soft::SPI::transfer_await</a></div><div class="ttdeci">uint8_t transfer_await()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de6/Soft_2SPI_8hh_source.html#l00249">SPI.hh:249</a></div></div>
<div class="ttc" id="classSD_html_ade7757d83420a87d23f3a16deccf1633"><div class="ttname"><a href="../../d7/da3/classSD.html#ade7757d83420a87d23f3a16deccf1633">SD::READ_TIMEOUT</a></div><div class="ttdeci">static const uint16_t READ_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00300">SD.hh:300</a></div></div>
<div class="ttc" id="classSD_html_a900e57070ece1f6ebce92869b815b388"><div class="ttname"><a href="../../d7/da3/classSD.html#a900e57070ece1f6ebce92869b815b388">SD::begin</a></div><div class="ttdeci">bool begin(SPI::Clock rate=SPI::DIV128_CLOCK)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00226">SD.cpp:226</a></div></div>
<div class="ttc" id="classSD_html_a2ce8db87ba97eedae513a7b1cdc3a50a"><div class="ttname"><a href="../../d7/da3/classSD.html#a2ce8db87ba97eedae513a7b1cdc3a50a">SD::RESPONSE_RETRY</a></div><div class="ttdeci">static const uint8_t RESPONSE_RETRY</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00308">SD.hh:308</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499a4916e8be79f25d94a60557103ee00cab"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a4916e8be79f25d94a60557103ee00cab">SD::ERASE_WR_BLK_END</a></div><div class="ttdoc">Set last write block to be erased. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00178">SD.hh:178</a></div></div>
<div class="ttc" id="classSD_html_a9f993839f8fc48e384cc92da109d8e7ea0438fc0b8ef1003899400c2ee6bc3373"><div class="ttname"><a href="../../d7/da3/classSD.html#a9f993839f8fc48e384cc92da109d8e7ea0438fc0b8ef1003899400c2ee6bc3373">SD::SD_SEND_OP_COND</a></div><div class="ttdoc">Host capacity support information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00193">SD.hh:193</a></div></div>
<div class="ttc" id="SD_8cpp_html_a5aa1f25b671940564734e68a00c2b4b6"><div class="ttname"><a href="../../de/d4e/SD_8cpp.html#a5aa1f25b671940564734e68a00c2b4b6">__PROGMEM</a></div><div class="ttdeci">static const uint16_t crctab[] __PROGMEM</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00047">SD.cpp:47</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499a6792a6a3db648c41db8818a61f33ab48"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a6792a6a3db648c41db8818a61f33ab48">SD::READ_OCR</a></div><div class="ttdoc">Read OCR register of a card. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00183">SD.hh:183</a></div></div>
<div class="ttc" id="classSoft_1_1SPI_html_ab0873ff9ab5084a6a0f679699613b39d"><div class="ttname"><a href="../../d5/d41/classSoft_1_1SPI.html#ab0873ff9ab5084a6a0f679699613b39d">Soft::SPI::transfer_start</a></div><div class="ttdeci">void transfer_start(uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de6/Soft_2SPI_8hh_source.html#l00238">SPI.hh:238</a></div></div>
<div class="ttc" id="classSD_html_a16eff982e611224ee97b6ad03a7c0a20a346854172cd4119c06e1014233c1a28c"><div class="ttname"><a href="../../d7/da3/classSD.html#a16eff982e611224ee97b6ad03a7c0a20a346854172cd4119c06e1014233c1a28c">SD::DATA_START_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00281">SD.hh:281</a></div></div>
<div class="ttc" id="classSD_html_a408ab2b7954ecc4db98cbc3cd20f8026"><div class="ttname"><a href="../../d7/da3/classSD.html#a408ab2b7954ecc4db98cbc3cd20f8026">SD::end</a></div><div class="ttdeci">bool end()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00283">SD.cpp:283</a></div></div>
<div class="ttc" id="namespaceSoft_html_a88b2fae91a80ef4be00e7da1dbc2da43"><div class="ttname"><a href="../../d6/db0/namespaceSoft.html#a88b2fae91a80ef4be00e7da1dbc2da43">Soft::spi</a></div><div class="ttdeci">SPI spi</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d38/SPI_8cpp_source.html#l00029">SPI.cpp:29</a></div></div>
<div class="ttc" id="classSD_html_a16eff982e611224ee97b6ad03a7c0a20aea46bbbb5bf9e387f420ad71f29dae1d"><div class="ttname"><a href="../../d7/da3/classSD.html#a16eff982e611224ee97b6ad03a7c0a20aea46bbbb5bf9e387f420ad71f29dae1d">SD::DATA_RES_MASK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00284">SD.hh:284</a></div></div>
<div class="ttc" id="classSoft_1_1SPI_html_ae3c7a86fc8be073bc6040e7636f2cf26"><div class="ttname"><a href="../../d5/d41/classSoft_1_1SPI.html#ae3c7a86fc8be073bc6040e7636f2cf26">Soft::SPI::release</a></div><div class="ttdeci">void release()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d70/SOFT__SPI_8cpp_source.html#l00064">SOFT_SPI.cpp:64</a></div></div>
<div class="ttc" id="classSD_html_a6522635a3d7b99c2cd7d922823a473fd"><div class="ttname"><a href="../../d7/da3/classSD.html#a6522635a3d7b99c2cd7d922823a473fd">SD::send</a></div><div class="ttdeci">uint8_t send(CMD command, uint32_t arg=0L)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00096">SD.cpp:96</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499a143c26dccb203c26fec85fdd5fb02d4c"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499a143c26dccb203c26fec85fdd5fb02d4c">SD::STOP_TRANSMISSION</a></div><div class="ttdoc">Stop Multiple Block Read. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00162">SD.hh:162</a></div></div>
<div class="ttc" id="structSD_1_1request__t_html_a40947492835335007148a050a76cb582"><div class="ttname"><a href="../../d8/d35/structSD_1_1request__t.html#a40947492835335007148a050a76cb582">SD::request_t::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00292">SD.hh:292</a></div></div>
<div class="ttc" id="classSD_html_a81472cd49b1880e2e7f518863199f499abebcb3f7d0615f4ed8b198312b39ec4a"><div class="ttname"><a href="../../d7/da3/classSD.html#a81472cd49b1880e2e7f518863199f499abebcb3f7d0615f4ed8b198312b39ec4a">SD::ERASE</a></div><div class="ttdoc">Erases selected write blocks. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00179">SD.hh:179</a></div></div>
<div class="ttc" id="classSD_html_a84241bbe485672c35b78e1a5a17ccf55"><div class="ttname"><a href="../../d7/da3/classSD.html#a84241bbe485672c35b78e1a5a17ccf55">SD::receive</a></div><div class="ttdeci">uint32_t receive()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4e/SD_8cpp_source.html#l00164">SD.cpp:164</a></div></div>
<div class="ttc" id="structSD_1_1request__t_html"><div class="ttname"><a href="../../d8/d35/structSD_1_1request__t.html">SD::request_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00291">SD.hh:291</a></div></div>
<div class="ttc" id="classSD_html_a74d33d37b8b98d2e1ad9f6af55ca1883a2e0601e809ff9703b1fcd5927955f95c"><div class="ttname"><a href="../../d7/da3/classSD.html#a74d33d37b8b98d2e1ad9f6af55ca1883a2e0601e809ff9703b1fcd5927955f95c">SD::TYPE_SD1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d36/SD_8hh_source.html#l00043">SD.hh:43</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="../../dir_8fbef5efe7af2d2033e5d85f5d5bf4f5.html">SD</a></li><li class="navelem"><a class="el" href="../../de/d4e/SD_8cpp.html">SD.cpp</a></li>
    <li class="footer">Generated on Thu Aug 31 2017 17:02:04 for COSA by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
